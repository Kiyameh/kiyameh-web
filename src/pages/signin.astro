---
export const prerender = false
import HtmlLayout from '@/layouts/HtmlLayout.astro'
import { SiGithub, SiGoogle } from '@icons-pack/react-simple-icons'

const {cookies, redirect, url} = Astro

const accessToken = cookies.get('sb-access-token')
const refreshToken = cookies.get('sb-refresh-token')

if (accessToken && refreshToken) {
  return redirect('/dashboard')
}

// Obtener mensaje de la URL
const message = url.searchParams.get('message')
---

<HtmlLayout pageTitle="Iniciar sesión">
  <div class="page-container">
    <main class="signin-box">
      <h1>Iniciar sesión</h1>

      {
        message === 'check-email' && (
          <div style="background: #d1fae5; border: 1px solid #10b981; color: #065f46; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
            <strong>¡Revisa tu email!</strong> Te hemos enviado un enlace de
            confirmación. Haz clic en el enlace para activar tu cuenta.
          </div>
        )
      }

      <p>
        ¿Nuevo aquí? <a
          href="/register"
          class="link"
          >Crea una cuenta</a
        >
      </p>

      <form
        action="/api/auth/signin"
        method="post"
      >
        <label for="email">Correo electrónico</label>
        <input
          type="email"
          name="email"
          id="email"
        />
        <label for="password">Contraseña</label>
        <input
          type="password"
          name="password"
          id="password"
        />
        <button type="submit" class="primary">Iniciar sesión</button>
      </form>

      <form
        action="/api/auth/signin"
        method="post"
      >
        <button
          value="github"
          name="provider"
          type="submit"
        >
          <SiGithub />
          Inicia sesión con Github
        </button>
      </form>

      <form
        action="/api/auth/signin"
        method="post"
      >
        <button
          value="google"
          name="provider"
          type="submit"
        >
          <SiGoogle />
          Inicia sesión con Google
        </button>
      </form>
    </main>
  </div>
</HtmlLayout>

<style>
  .page-container {
    min-height: 100lvh;
    width: 100%;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .signin-box {
    background-color: var(--surface-300);
    padding: 2rem;
    border-radius: var(--radius-large);
    box-shadow: var(--shadow-large);
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 400px;
    width: 100%;
    margin: 0 auto;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  input {
    width: 100%;
    padding: 0.5rem;
    border-radius: var(--radius-small);
    border: 1px solid var(--border-soft);
    background-color: var(--surface-300);
    color: var(--content);
    font-size: 1rem;
    background-color: var(--surface-100);
  }

  button {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid var(--border-soft);
    border-radius: var(--radius-small);
    background-color: var(--surface-200);
    color: var(--content)
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
justify-content: center;

  }
  .primary{
    color: var(--accent-content);
    background-color: var(--accent);

  }
</style>
