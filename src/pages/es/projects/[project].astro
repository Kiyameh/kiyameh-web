---
import Breadcrumb from '@/components/ui/Breadcrumb/Breadcrumb'
import ProjectTypeBadge from '@/components/ui/ProjectTypeBadge/ProjectTypeBadge'
import SectionTitle from '@/components/ui/SectionTitle/SectionTitle'
import LinesOfCode from '@/components/elements/LinesOfCode/LinesOfCode'
import LanguagePercents from '@/components/elements/LanguagePercents/LanguagePercents'
import PortfolioLayout from '@/layouts/PortfolioLayout.astro'
import {getCollection} from 'astro:content'
import {Github, Info} from 'lucide-react'
import {createRepoCard} from 'github-repo-stats-card'

// Obtener el slug del parámetro dinámico
export async function getStaticPaths() {
  const projects = await getCollection('projects')
  return projects.map((project) => ({
    params: {project: project.data.slug},
    props: {project},
  }))
}

const {project} = Astro.props

const {repository, description, name, type, slug, technologies} = project.data

createRepoCard('#repo-stats-card', repository || '')
---

<PortfolioLayout>
  <div class="container">
    <header class="header">
      <Breadcrumb
        client:load
        items={[
          {label: 'Inicio', href: '/es'},
          {label: 'Proyectos', href: '/es/projects'},
          {label: project.data.name, href: `/es/projects/${project.data.slug}`},
        ]}
      />
      <div class="title-box">
        <SectionTitle
          client:load
          id=""
          level="title"
        >
          {project.data.name}
        </SectionTitle>
        <ProjectTypeBadge type={project?.data.type || ''} />
      </div>
    </header>
    <main class="content">
      <section class="overview">
        <p class="info-box">
          <Info />
          {project?.data.description}
        </p>
      </section>
      <!--  <section class="overview">
        <Github />
        {
          repository && (
            <LinesOfCode
              client:load
              repositoryUrl={repository}
            />
            <LanguagePercents
              client:load
              repositoryUrl={repository}
            />
          )
        }
      </section> -->
      <section class="overview">
        <h2>Estadísticas del repositorio</h2>
        <div id="repo-stats-card"></div>
      </section>
    </main>
  </div>
</PortfolioLayout>

<style>
  .container {
    width: 100%;
    max-width: 1024px;
    min-height: 100vh;
    margin: 0 auto;
    background-color: var(--surface-100);
    display: flex;
    flex-direction: column;
    align-items: start;
    gap: 2rem;
    padding: 4rem;
  }

  @media (max-width: 768px) {
    .container {
      padding: 2rem;
    }
  }

  /* Header */

  .header {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: start;
    gap: 1rem;
  }

  .title-box {
    width: 100%;
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 1rem;
  }

  /* Content */
  .content {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: start;
    gap: 1rem;
  }
  .overview {
    width: 100%;
    padding: 1rem;
    background-color: var(--surface-300);
    border-radius: var(--radius-large);
  }
  .info-box {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
</style>
